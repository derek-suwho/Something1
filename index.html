<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Avatar Chat Room</title>
    
    <!-- Security: Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' https://api.openai.com; font-src 'self'; img-src 'self' data:; media-src 'self';">
    
    <!-- Security: Additional headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="container">
        <canvas id="three-canvas"></canvas>
        
        <div id="chat-interface">
            <div id="chat-messages"></div>
            <div id="input-container">
                <input type="text" id="chat-input" placeholder="Type your message or click ðŸŽ¤ to speak...">
                <button id="voice-button">ðŸŽ¤</button>
                <button id="send-button">Send</button>
            </div>
        </div>

        <div id="controls">
            <button id="toggle-chat">ðŸ’¬</button>
            <div id="status">Ready</div>
        </div>

        <div id="settings">
            <input type="password" id="openai-key" placeholder="Enter OpenAI API Key">
            <button id="save-key">Save Key</button>
            <select id="model-picker">
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                <option value="gpt-4">GPT-4</option>
                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                <option value="gpt-4o">GPT-4o</option>
                <option value="gpt-4o-mini">GPT-4o Mini</option>
            </select>
        </div>
    </div>

    <!-- Three.js Local Scripts -->
    <script>
        // Debug script loading
        console.log('Loading Three.js...');
        window.addEventListener('load', () => {
            console.log('Page loaded, checking THREE:', typeof THREE);
            if (typeof THREE === 'undefined') {
                console.error('THREE is not defined after page load');
            } else {
                console.log('THREE loaded successfully');
            }
        });
    </script>
    <script src="three.min.js" onload="console.log('Three.js loaded successfully, THREE:', typeof THREE)" onerror="console.error('Failed to load Three.js locally')"></script>
    <script src="OrbitControls.js" onload="console.log('OrbitControls loaded successfully')" onerror="console.error('Failed to load OrbitControls locally')"></script>
    <script src="config.js"></script>
    <script src="script.js"></script>
</body>
</html>